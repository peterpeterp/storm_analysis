

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TC_support &mdash; feature_tracking  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> feature_tracking
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../content.html">Modules</a></li>
</ul>

            
          
    <a href="genindex.html">Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">feature_tracking</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>TC_support</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for TC_support</h1><div class="highlight"><pre>
<span></span><span class="c1"># Author: Peter Pfleiderer &lt;peter.pfleiderer@climateanalytics.org&gt;</span>
<span class="c1">#</span>
<span class="c1"># License: GNU General Public License v3.0</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">sys</span><span class="o">,</span><span class="nn">glob</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">collections</span><span class="o">,</span><span class="nn">gc</span><span class="o">,</span><span class="nn">calendar</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="k">import</span> <span class="n">Dataset</span><span class="p">,</span><span class="n">num2date</span>
<span class="kn">import</span> <span class="nn">dimarray</span> <span class="k">as</span> <span class="nn">da</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage</span> <span class="k">as</span> <span class="nn">ndimage</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage.filters</span> <span class="k">as</span> <span class="nn">filters</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1">#------------- get atlantic tc&#39;s from ibtracks</span>
<div class="viewcode-block" id="get_atl_tcs"><a class="viewcode-back" href="../TC_support.html#TC_support.get_atl_tcs">[docs]</a><span class="k">def</span> <span class="nf">get_atl_tcs</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;/Users/peterpfleiderer/Projects/tropical_cyclones/data/Allstorms.ibtracs_all.v03r10.nc&#39;</span><span class="p">):</span>
    <span class="n">TC</span><span class="o">=</span><span class="n">da</span><span class="o">.</span><span class="n">read_nc</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="c1"># select north atlantic basin</span>
    <span class="n">tc_sel</span><span class="o">=</span><span class="n">TC</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">TC</span><span class="p">[</span><span class="s1">&#39;basin&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># select time period</span>
    <span class="n">tc_sel</span><span class="o">=</span><span class="n">tc_sel</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">tc_sel</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1981</span><span class="p">,:]</span>
    <span class="c1"># select main tracks</span>
    <span class="n">tc_sel</span><span class="o">=</span><span class="n">tc_sel</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">tc_sel</span><span class="p">[</span><span class="s1">&#39;track_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,:]</span>

    <span class="n">tc_lat</span><span class="o">=</span><span class="n">tc_sel</span><span class="p">[</span><span class="s1">&#39;lat_for_mapping&#39;</span><span class="p">]</span>
    <span class="n">tc_lon</span><span class="o">=</span><span class="n">tc_sel</span><span class="p">[</span><span class="s1">&#39;lon_for_mapping&#39;</span><span class="p">]</span>
    <span class="c1"># tc_sel=tc_sel.ix[np.where(tc_sel_cat&gt;0)]</span>
    <span class="n">tmp_time</span><span class="o">=</span><span class="n">tc_sel</span><span class="p">[</span><span class="s1">&#39;source_time&#39;</span><span class="p">]</span>
    <span class="n">tc_year</span><span class="p">,</span><span class="n">tc_month</span><span class="p">,</span><span class="n">tc_yrmn</span><span class="p">,</span><span class="n">tc_yrFr</span><span class="o">=</span><span class="n">tmp_time</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">tmp_time</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">tmp_time</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">tmp_time</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">storm</span> <span class="ow">in</span> <span class="n">tmp_time</span><span class="o">.</span><span class="n">storm</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">tmp_time</span><span class="o">.</span><span class="n">time</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">tmp_time</span><span class="p">[</span><span class="n">storm</span><span class="p">,</span><span class="n">tt</span><span class="p">]):</span>
                <span class="n">datevar</span><span class="o">=</span><span class="n">num2date</span><span class="p">(</span><span class="n">tmp_time</span><span class="p">[</span><span class="n">storm</span><span class="p">,</span><span class="n">tt</span><span class="p">],</span><span class="n">units</span> <span class="o">=</span> <span class="n">tmp_time</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
                <span class="n">tc_year</span><span class="p">[</span><span class="n">storm</span><span class="p">,</span><span class="n">tt</span><span class="p">]</span><span class="o">=</span><span class="n">datevar</span><span class="o">.</span><span class="n">year</span>
                <span class="n">tc_month</span><span class="p">[</span><span class="n">storm</span><span class="p">,</span><span class="n">tt</span><span class="p">]</span><span class="o">=</span><span class="n">datevar</span><span class="o">.</span><span class="n">month</span>
                <span class="n">tc_yrmn</span><span class="p">[</span><span class="n">storm</span><span class="p">,</span><span class="n">tt</span><span class="p">]</span><span class="o">=</span><span class="n">datevar</span><span class="o">.</span><span class="n">year</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datevar</span><span class="o">.</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">12.</span>
                <span class="n">tc_yrFr</span><span class="p">[</span><span class="n">storm</span><span class="p">,</span><span class="n">tt</span><span class="p">]</span><span class="o">=</span><span class="n">toYearFraction</span><span class="p">(</span><span class="n">datevar</span><span class="p">)</span>

    <span class="c1"># remove extratropical time steps (and distrubances)</span>
    <span class="n">tc_wind</span><span class="o">=</span><span class="n">tc_sel</span><span class="p">[</span><span class="s1">&#39;source_wind&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ix</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tc_wind</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">tc_sel</span><span class="p">[</span><span class="s1">&#39;nature_for_mapping&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">tc_wind</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">tc_sel</span><span class="p">[</span><span class="s1">&#39;nature_for_mapping&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">tc_pres</span><span class="o">=</span><span class="n">tc_sel</span><span class="p">[</span><span class="s1">&#39;source_pres&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ix</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tc_pres</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">tc_sel</span><span class="p">[</span><span class="s1">&#39;nature_for_mapping&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">tc_pres</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">tc_sel</span><span class="p">[</span><span class="s1">&#39;nature_for_mapping&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="n">ds</span><span class="o">=</span><span class="n">da</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span>
        <span class="s1">&#39;wind&#39;</span><span class="p">:</span><span class="n">tc_wind</span><span class="p">,</span>
        <span class="s1">&#39;mslp&#39;</span><span class="p">:</span><span class="n">tc_pres</span><span class="p">,</span>
        <span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">tc_lat</span><span class="p">,</span>
        <span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">tc_lon</span><span class="p">,</span>
        <span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">tc_sel</span><span class="p">[</span><span class="s1">&#39;source_time&#39;</span><span class="p">],</span>
        <span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="n">tc_year</span><span class="p">,</span>
        <span class="s1">&#39;month&#39;</span><span class="p">:</span><span class="n">tc_month</span><span class="p">,</span>
        <span class="s1">&#39;yrmn&#39;</span><span class="p">:</span><span class="n">tc_yrmn</span><span class="p">,</span>
        <span class="s1">&#39;yrFr&#39;</span><span class="p">:</span><span class="n">tc_yrFr</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span></div>

<span class="c1">#------------ Met stuff</span>
<div class="viewcode-block" id="rel_vort"><a class="viewcode-back" href="../TC_support.html#TC_support.rel_vort">[docs]</a><span class="k">def</span> <span class="nf">rel_vort</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;adapted from wrftools: github.com/keltonhalbert/wrftools&quot;&quot;&quot;</span>
    <span class="n">xx</span><span class="p">,</span><span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="n">xx</span><span class="o">*=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">yy</span><span class="p">))</span><span class="o">*</span><span class="mi">6371000</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">360.</span>
    <span class="n">yy</span><span class="o">*=</span><span class="mi">6371000</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">360.</span>
    <span class="n">dy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
    <span class="n">dx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>

    <span class="n">vort</span><span class="o">=</span><span class="n">U</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">du</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:]</span> <span class="p">)</span>
        <span class="n">dv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span> <span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:]</span> <span class="p">)</span>
        <span class="n">vort</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:]</span><span class="o">=</span> <span class="n">dv</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">dx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">du</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">dy</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">vort</span></div>

<div class="viewcode-block" id="wind_speed"><a class="viewcode-back" href="../TC_support.html#TC_support.wind_speed">[docs]</a><span class="k">def</span> <span class="nf">wind_speed</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">V</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">V</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span></div>

<span class="c1"># ----------- Time conversions</span>

<div class="viewcode-block" id="toYearFraction"><a class="viewcode-back" href="../TC_support.html#TC_support.toYearFraction">[docs]</a><span class="k">def</span> <span class="nf">toYearFraction</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
    <span class="n">date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span>
    <span class="n">startOfThisYear</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">startOfNextYear</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">yearElapsed</span> <span class="o">=</span> <span class="p">(</span><span class="n">date</span> <span class="o">-</span> <span class="n">startOfThisYear</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="n">yearDuration</span> <span class="o">=</span> <span class="p">(</span><span class="n">startOfNextYear</span> <span class="o">-</span> <span class="n">startOfThisYear</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="n">fraction</span> <span class="o">=</span> <span class="n">yearElapsed</span><span class="o">/</span><span class="n">yearDuration</span>

    <span class="k">return</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="n">fraction</span></div>

<div class="viewcode-block" id="yearFractiontoDate"><a class="viewcode-back" href="../TC_support.html#TC_support.yearFractiontoDate">[docs]</a><span class="k">def</span> <span class="nf">yearFractiontoDate</span><span class="p">(</span><span class="n">yr_fr</span><span class="p">):</span>
    <span class="n">year</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">yr_fr</span><span class="p">)</span>
    <span class="n">fr</span><span class="o">=</span><span class="n">yr_fr</span><span class="o">-</span><span class="n">year</span>
    <span class="n">startOfEpoch</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">1970</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">startOfThisYear</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">startOfNextYear</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">yearDuration</span> <span class="o">=</span> <span class="p">(</span><span class="n">startOfNextYear</span> <span class="o">-</span> <span class="n">startOfThisYear</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="n">seconds</span><span class="o">=</span><span class="n">fr</span><span class="o">*</span><span class="n">yearDuration</span><span class="o">+</span><span class="p">(</span><span class="n">startOfThisYear</span> <span class="o">-</span> <span class="n">startOfEpoch</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="n">dt</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">dt</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="n">dt</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="n">dt</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="n">dt</span><span class="o">.</span><span class="n">tm_hour</span><span class="p">)</span></div>

<span class="c1">#----------- utilities</span>

<div class="viewcode-block" id="running_mean"><a class="viewcode-back" href="../TC_support.html#TC_support.running_mean">[docs]</a><span class="k">def</span> <span class="nf">running_mean</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">N</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">xx</span>
	<span class="k">if</span> <span class="n">N</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
	    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
	    <span class="n">ru_mean</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
	    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)):</span>
			<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span><span class="n">t</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)]))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
				<span class="n">ru_mean</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span><span class="n">t</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span>
	    <span class="k">return</span> <span class="n">ru_mean</span></div>

<div class="viewcode-block" id="running_cumsum"><a class="viewcode-back" href="../TC_support.html#TC_support.running_cumsum">[docs]</a><span class="k">def</span> <span class="nf">running_cumsum</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">N</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">xx</span>
	<span class="k">if</span> <span class="n">N</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
	    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
	    <span class="n">ru_sum</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
	    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="p">):</span><span class="n">t</span><span class="p">]))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
				<span class="n">ru_sum</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="p">):</span><span class="n">t</span><span class="p">])</span>
	    <span class="k">return</span> <span class="n">ru_sum</span></div>

<span class="c1">#------------ TC stuff</span>

<div class="viewcode-block" id="tc_cat"><a class="viewcode-back" href="../TC_support.html#TC_support.tc_cat">[docs]</a><span class="k">def</span> <span class="nf">tc_cat</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;pressure&#39;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">cat__</span><span class="p">(</span><span class="n">zz</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;wind&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">zz</span><span class="o">&lt;=</span><span class="mi">64</span><span class="p">:</span> <span class="n">cat</span><span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">zz</span><span class="o">&gt;</span><span class="mi">64</span><span class="p">:</span> <span class="n">cat</span><span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">zz</span><span class="o">&gt;</span><span class="mi">82</span><span class="p">:</span> <span class="n">cat</span><span class="o">=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">zz</span><span class="o">&gt;</span><span class="mi">95</span><span class="p">:</span> <span class="n">cat</span><span class="o">=</span> <span class="mi">3</span>
            <span class="k">if</span> <span class="n">zz</span><span class="o">&gt;</span><span class="mi">112</span><span class="p">:</span> <span class="n">cat</span><span class="o">=</span> <span class="mi">4</span>
            <span class="k">if</span> <span class="n">zz</span><span class="o">&gt;</span><span class="mi">136</span><span class="p">:</span> <span class="n">cat</span><span class="o">=</span> <span class="mi">5</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">zz</span><span class="p">):</span> <span class="n">cat</span><span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="n">cat</span>
        <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;pressure&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">zz</span><span class="o">&gt;=</span><span class="mi">1020</span><span class="p">:</span> <span class="n">cat</span><span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">zz</span><span class="o">&lt;</span><span class="mi">1020</span><span class="p">:</span> <span class="n">cat</span><span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">zz</span><span class="o">&lt;</span><span class="mi">980</span><span class="p">:</span> <span class="n">cat</span><span class="o">=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">zz</span><span class="o">&lt;</span><span class="mi">965</span><span class="p">:</span> <span class="n">cat</span><span class="o">=</span> <span class="mi">3</span>
            <span class="k">if</span> <span class="n">zz</span><span class="o">&lt;</span><span class="mi">945</span><span class="p">:</span> <span class="n">cat</span><span class="o">=</span> <span class="mi">4</span>
            <span class="k">if</span> <span class="n">zz</span><span class="o">&lt;</span><span class="mi">920</span><span class="p">:</span> <span class="n">cat</span><span class="o">=</span> <span class="mi">5</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">zz</span><span class="p">):</span> <span class="n">cat</span><span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="n">cat</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">da</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">dimarraycls</span><span class="o">.</span><span class="n">DimArray</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cat__</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="n">z</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cat__</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></div>

<div class="viewcode-block" id="normalize180"><a class="viewcode-back" href="../TC_support.html#TC_support.normalize180">[docs]</a><span class="k">def</span> <span class="nf">normalize180</span><span class="p">(</span><span class="n">lon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Normalize lon to range [180, 180)&quot;&quot;&quot;</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="o">-</span><span class="mf">180.</span><span class="p">;</span> <span class="n">upper</span> <span class="o">=</span> <span class="mf">180.</span>
    <span class="k">if</span> <span class="n">lon</span> <span class="o">&gt;</span> <span class="n">upper</span> <span class="ow">or</span> <span class="n">lon</span> <span class="o">==</span> <span class="n">lower</span><span class="p">:</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lon</span> <span class="o">+</span> <span class="n">upper</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">upper</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">lon</span> <span class="o">&lt;</span> <span class="n">lower</span> <span class="ow">or</span> <span class="n">lon</span> <span class="o">==</span> <span class="n">upper</span><span class="p">:</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">upper</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lon</span> <span class="o">-</span> <span class="n">lower</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">upper</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">lower</span> <span class="k">if</span> <span class="n">lon</span> <span class="o">==</span> <span class="n">upper</span> <span class="k">else</span> <span class="n">lon</span></div>

<div class="viewcode-block" id="tc_wind_color"><a class="viewcode-back" href="../TC_support.html#TC_support.tc_wind_color">[docs]</a><span class="k">def</span> <span class="nf">tc_wind_color</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">z</span><span class="o">&lt;=</span><span class="mi">64</span><span class="p">:</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;lightblue&#39;</span>
    <span class="k">if</span> <span class="n">z</span><span class="o">&gt;</span><span class="mi">64</span><span class="p">:</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;#ffffcc&#39;</span>
    <span class="k">if</span> <span class="n">z</span><span class="o">&gt;</span><span class="mi">82</span><span class="p">:</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;#ffe775&#39;</span>
    <span class="k">if</span> <span class="n">z</span><span class="o">&gt;</span><span class="mi">95</span><span class="p">:</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;#ffc148&#39;</span>
    <span class="k">if</span> <span class="n">z</span><span class="o">&gt;</span><span class="mi">112</span><span class="p">:</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;#ff8f20&#39;</span>
    <span class="k">if</span> <span class="n">z</span><span class="o">&gt;</span><span class="mi">136</span><span class="p">:</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;#ff6060&#39;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">):</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;lightblue&#39;</span>
    <span class="k">return</span> <span class="n">color</span></div>

<div class="viewcode-block" id="tc_pressure_color"><a class="viewcode-back" href="../TC_support.html#TC_support.tc_pressure_color">[docs]</a><span class="k">def</span> <span class="nf">tc_pressure_color</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">z</span><span class="o">&gt;=</span><span class="mi">1020000</span><span class="p">:</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;lightblue&#39;</span>
    <span class="k">if</span> <span class="n">z</span><span class="o">&lt;</span><span class="mi">1020000</span><span class="p">:</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;#ffffcc&#39;</span>
    <span class="k">if</span> <span class="n">z</span><span class="o">&lt;</span><span class="mi">98000</span><span class="p">:</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;#ffe775&#39;</span>
    <span class="k">if</span> <span class="n">z</span><span class="o">&lt;</span><span class="mi">96500</span><span class="p">:</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;#ffc148&#39;</span>
    <span class="k">if</span> <span class="n">z</span><span class="o">&lt;</span><span class="mi">94500</span><span class="p">:</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;#ff8f20&#39;</span>
    <span class="k">if</span> <span class="n">z</span><span class="o">&lt;</span><span class="mi">92000</span><span class="p">:</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;#ff6060&#39;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">):</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;lightblue&#39;</span>
    <span class="k">return</span> <span class="n">color</span></div>

<div class="viewcode-block" id="tc_plot"><a class="viewcode-back" href="../TC_support.html#TC_support.tc_plot">[docs]</a><span class="k">def</span> <span class="nf">tc_plot</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">color_type</span><span class="o">=</span><span class="n">tc_wind_color</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tmp</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">color_type</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">tmp</span></div>

<div class="viewcode-block" id="latlon_to_meshgrid"><a class="viewcode-back" href="../TC_support.html#TC_support.latlon_to_meshgrid">[docs]</a><span class="k">def</span> <span class="nf">latlon_to_meshgrid</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">lon</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">lat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1">#x-=np.diff(x,1)[0]/2.</span>
    <span class="c1">#y-=np.diff(y,1)[0]/2.</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">,[</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">,[</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span></div>

<div class="viewcode-block" id="local_extrem_filters"><a class="viewcode-back" href="../TC_support.html#TC_support.local_extrem_filters">[docs]</a><span class="k">def</span> <span class="nf">local_extrem_filters</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">method</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span><span class="n">neighborhood_size</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
    <span class="n">data_max</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">maximum_filter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">neighborhood_size</span><span class="p">)</span>
    <span class="n">data_min</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">minimum_filter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">neighborhood_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;max&#39;</span><span class="p">:</span>
        <span class="n">extreme</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="n">data_max</span><span class="p">)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="p">((</span><span class="n">data_max</span> <span class="o">-</span> <span class="n">data_min</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;min&#39;</span><span class="p">:</span>
        <span class="n">extreme</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="n">data_min</span><span class="p">)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="p">((</span><span class="n">data_max</span> <span class="o">-</span> <span class="n">data_min</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span>
    <span class="n">extreme</span><span class="p">[</span><span class="n">diff</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">labeled</span><span class="p">,</span> <span class="n">num_objects</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">extreme</span><span class="p">)</span>
    <span class="n">slices</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">labeled</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dy</span><span class="p">,</span><span class="n">dx</span> <span class="ow">in</span> <span class="n">slices</span><span class="p">:</span>
        <span class="n">x_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">dx</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x_center</span><span class="p">))</span>
        <span class="n">y_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">dy</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">dy</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y_center</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">y</span><span class="p">,</span><span class="n">x</span></div>


<div class="viewcode-block" id="local_extrem"><a class="viewcode-back" href="../TC_support.html#TC_support.local_extrem">[docs]</a><span class="k">def</span> <span class="nf">local_extrem</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">neighborhood_size</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">ex_x</span><span class="p">,</span><span class="n">ex_y</span><span class="o">=</span><span class="p">[],[]</span>
    <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;max&#39;</span><span class="p">:</span>
        <span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">y_</span><span class="p">,</span><span class="n">x_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">y_</span><span class="p">,</span><span class="n">x_</span><span class="p">]</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">y_</span><span class="o">-</span><span class="n">neighborhood_size</span><span class="p">]):</span><span class="nb">min</span><span class="p">([</span><span class="n">y_</span><span class="o">+</span><span class="n">neighborhood_size</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">x_</span><span class="o">-</span><span class="n">neighborhood_size</span><span class="p">]):</span><span class="nb">min</span><span class="p">([</span><span class="n">x_</span><span class="o">+</span><span class="n">neighborhood_size</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])]):</span>
                <span class="n">ex_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_</span><span class="p">)</span>
                <span class="n">ex_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;min&#39;</span><span class="p">:</span>
        <span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="o">&lt;</span><span class="n">threshold</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">y_</span><span class="p">,</span><span class="n">x_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">y_</span><span class="p">,</span><span class="n">x_</span><span class="p">]</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">y_</span><span class="o">-</span><span class="n">neighborhood_size</span><span class="p">]):</span><span class="nb">min</span><span class="p">([</span><span class="n">y_</span><span class="o">+</span><span class="n">neighborhood_size</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">x_</span><span class="o">-</span><span class="n">neighborhood_size</span><span class="p">]):</span><span class="nb">min</span><span class="p">([</span><span class="n">x_</span><span class="o">+</span><span class="n">neighborhood_size</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])]):</span>
                <span class="n">ex_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_</span><span class="p">)</span>
                <span class="n">ex_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ex_y</span><span class="p">,</span><span class="n">ex_x</span></div>

<span class="c1"># -------------- other</span>

<span class="c1"># unique / set for a list of lists</span>
<div class="viewcode-block" id="uniq"><a class="viewcode-back" href="../TC_support.html#TC_support.uniq">[docs]</a><span class="k">def</span> <span class="nf">uniq</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="n">last</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">last</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">yield</span> <span class="n">item</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">item</span></div>

<div class="viewcode-block" id="unique"><a class="viewcode-back" href="../TC_support.html#TC_support.unique">[docs]</a><span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">uniq</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)))</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Peter Pfleiderer.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>